<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teachable Machine – Ljudmodell</title>
</head>
<body>
    <h1>Teachable Machine – Ljudklassificering</h1>
    <button type="button" onclick="init()">Starta lyssning</button>
    <div id="label-container"></div>

    <!-- Teachable Machine Sound Library -->
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/sound@0.8/dist/teachablemachine-sound.min.js"></script>

    <script type="text/javascript">
        const URL = "./"; // där model.json och metadata.json ligger

        let model, labelContainer, maxPredictions;

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // Ladda modellen och metadata
            model = await tmSound.load(modelURL, metadataURL);
            maxPredictions = model.labels.length;

            labelContainer = document.getElementById("label-container");
            labelContainer.innerHTML = "";

            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }

            // Börja lyssna på mikrofonen
            model.listen(result => {
                for (let i = 0; i < maxPredictions; i++) {
                    const classPrediction =
                        result[i].className + ": " + (result[i].probability * 100).toFixed(2) + "%";
                    labelContainer.childNodes[i].innerHTML = classPrediction;
                }
            }, {
                includeSpectrogram: true,
                probabilityThreshold: 0.75, // justera detta vid behov
                overlapFactor: 0.5
            });
        }

        // Avsluta lyssning när sidan stängs
        window.addEventListener("unload", () => {
            if (model) {
                model.stopListening();
            }
        });
    </script>
</body>
</html>